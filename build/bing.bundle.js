!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=11)}([function(t,e,n){"use strict";e.__esModule=!0;var r=n(2),i=function(){function t(){}return t.prototype.getAqiText=function(t,e){console.log("getAqiText("+t+","+e+")");var n=function(t){return"-"==t?0:t<=50?1:t<=100?2:t<=150?3:t<=200?4:t<=300?5:6},r="aqivalues"+e,i=chrome.i18n.getMessage(r).split(",");return console.log("labels:",r,"->",i),i[n(t=i[n(t)])].trim()},t.prototype.getText=function(t,e){var n={air_quality:{en:" Air Quality",cn:"空气污染",hk:"空氣污染",jp:"大気汚染",kr:"대기 오염"}};return void 0!==n[t]?void 0!==n[t][e]?n[t][e]:n[t].en:"???"},t.prototype.getTitle=function(t){return t.city.name+this.getText("air_quality",t.clang)},t.prototype.getShortTitle=function(t){return t.city.name+" AQI"},t}();e.aqiLang=new i;var o=function(){function t(){}return t.prototype.cityObject=function(){return new r.Promise(function(t){chrome.runtime.sendMessage({method:"getSelectedCity"},function(e){t(e)})})},t.prototype.setCityObject=function(t){chrome.runtime.sendMessage({method:"setSelectedCity",city:t},function(t){})},t.prototype.updateAQI=function(t){if(t)return t.forecast&&(void 0!==t.forecast[t.clang]?t.weather=t.forecast[t.clang]:t.weather=t.forecast.en),void 0!==t["info"+t.clang]&&(t.info=t["info"+t.clang]),"hk"==t.clang&&void 0!==t.infocn&&(t.info=t.infocn),void 0!==t["utime"+t.clang]&&(t.utime=t["utime"+t.clang]),"hk"==t.clang&&void 0!==t.utimecn&&(t.utime=t.utimecn),"cn"==t.clang||"hk"==t.clang||"jp"==t.clang||"kr"==t.clang?t.name=t.namena:t.name=t.nameen,t},t.prototype.updateFeed=function(t){return t},t.prototype.updateData=function(t,e){return"Aqi"==t?this.updateAQI(e):e},t.prototype.checkOption=function(t){return new r.Promise(function(e){chrome.runtime.sendMessage({method:"checkOption",opt:t},function(t){e(t)})})},t.prototype.onFeedUpdate=function(t){this.onDataUpdate("Feed",t)},t.prototype.onDataUpdate=function(t,e){var n=this,r="on"+t+"Update";chrome.runtime.onMessage.addListener(function(i,o,a){i.method==r?e(n.updateData(t,i.aqi)):console.log("Received unknown message:",i.method)}),chrome.runtime.sendMessage({method:"load"+t},function(r){e(n.updateData(t,r))})},t}();e.AqiSettings=o},function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t){t&&"string"==typeof t&&"#"==t[0]?this.node=document.getElementById(t.substr(1)):t&&"object"==typeof t&&1==t.nodeType?this.node=t:t&&console.log("s3: Creating from unknown object",t)}return t.prototype.c=function(e,n,r,i){var o;if(void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),n&&"string"!=typeof n&&(i=r,r=n,n=null),o="svg:"==e.substr(0,4)?document.createElementNS("http://www.w3.org/2000/svg",e.substr(4)):document.createElement(e),n&&(o.className=n),r)for(var a in r)o.style[a]=r[a];return i&&(o.innerHTML=i),this.node&&this.node.appendChild(o),new t(o)},t.prototype.a=function(t){for(var e in t)this.node.setAttribute(e,t[e]);return this},t.prototype.i=function(t){return t.node?this.node.appendChild(t.node):(console.log("i:","trying to insert a non-existant node",t),window.sdlkfjslk()),this},t.prototype.t=function(t){if("string"==typeof t){var e=document.createTextNode(t);this.node.appendChild(e)}return this},t.prototype.empty=function(){for(;this.node&&this.node.firstChild;)this.node.firstChild.remove();return this},t.prototype.up=function(){return this.node=this.node.parent(),this},t}();e.S3=r,e.s3=function(t){return void 0===t&&(t=null),new r(t)}},function(t,e,n){(function(e,n){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4+314e4831
 */
!function(e,n){t.exports=n()}(0,function(){"use strict";function t(t){return"function"==typeof t}var r=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=0,o=void 0,a=void 0,s=function(t,e){p[i]=t,p[i+1]=e,2===(i+=2)&&(a?a(v):m())};var c="undefined"!=typeof window?window:void 0,u=c||{},l=u.MutationObserver||u.WebKitMutationObserver,f="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var t=setTimeout;return function(){return t(v,1)}}var p=new Array(1e3);function v(){for(var t=0;t<i;t+=2){(0,p[t])(p[t+1]),p[t]=void 0,p[t+1]=void 0}i=0}var m=void 0;function g(t,e){var n=this,r=new this.constructor(_);void 0===r[w]&&I(r);var i=n._state;if(i){var o=arguments[i-1];s(function(){return L(i,r,o,n._result)})}else j(n,r,t,e);return r}function y(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(_);return S(e,t),e}m=f?function(){return e.nextTick(v)}:l?function(){var t=0,e=new l(v),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():d?function(){var t=new MessageChannel;return t.port1.onmessage=v,function(){return t.port2.postMessage(0)}}():void 0===c?function(){try{var t=Function("return this")().require("vertx");return void 0!==(o=t.runOnLoop||t.runOnContext)?function(){o(v)}:h()}catch(t){return h()}}():h();var w=Math.random().toString(36).substring(2);function _(){}var b=void 0,A=1,q=2,x={error:null};function T(t){try{return t.then}catch(t){return x.error=t,x}}function E(e,n,r){n.constructor===e.constructor&&r===g&&n.constructor.resolve===y?function(t,e){e._state===A?k(t,e._result):e._state===q?C(t,e._result):j(e,void 0,function(e){return S(t,e)},function(e){return C(t,e)})}(e,n):r===x?(C(e,x.error),x.error=null):void 0===r?k(e,n):t(r)?function(t,e,n){s(function(t){var r=!1,i=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,function(n){r||(r=!0,e!==n?S(t,n):k(t,n))},function(e){r||(r=!0,C(t,e))},t._label);!r&&i&&(r=!0,C(t,i))},t)}(e,n,r):k(e,n)}function S(t,e){t===e?C(t,new TypeError("You cannot resolve a promise with itself")):!function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)?k(t,e):E(t,e,T(e))}function M(t){t._onerror&&t._onerror(t._result),O(t)}function k(t,e){t._state===b&&(t._result=e,t._state=A,0!==t._subscribers.length&&s(O,t))}function C(t,e){t._state===b&&(t._state=q,t._result=e,s(M,t))}function j(t,e,n,r){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+A]=n,i[o+q]=r,0===o&&t._state&&s(O,t)}function O(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,a=0;a<e.length;a+=3)r=e[a],i=e[a+n],r?L(n,r,i,o):i(o);t._subscribers.length=0}}function L(e,n,r,i){var o=t(r),a=void 0,s=void 0,c=void 0,u=void 0;if(o){if((a=function(t,e){try{return t(e)}catch(t){return x.error=t,x}}(r,i))===x?(u=!0,s=a.error,a.error=null):c=!0,n===a)return void C(n,new TypeError("A promises callback cannot return that same promise."))}else a=i,c=!0;n._state!==b||(o&&c?S(n,a):u?C(n,s):e===A?k(n,a):e===q&&C(n,a))}var P=0;function I(t){t[w]=P++,t._state=void 0,t._result=void 0,t._subscribers=[]}var D=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(_),this.promise[w]||I(this.promise),r(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?k(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&k(this.promise,this._result))):C(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===b&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===y){var i=T(t);if(i===g&&t._state!==b)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(n===Q){var o=new n(_);E(o,t,i),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===b&&(this._remaining--,t===q?C(r,n):this._result[e]=n),0===this._remaining&&k(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;j(t,void 0,function(t){return n._settledAt(A,e,t)},function(t){return n._settledAt(q,e,t)})},t}();var Q=function(){function t(e){this[w]=P++,this._result=this._state=void 0,this._subscribers=[],_!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(t,e){try{e(function(e){S(t,e)},function(e){C(t,e)})}catch(e){C(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})},t}();return Q.prototype.then=g,Q.all=function(t){return new D(this,t).promise},Q.race=function(t){var e=this;return r(t)?new e(function(n,r){for(var i=t.length,o=0;o<i;o++)e.resolve(t[o]).then(n,r)}):new e(function(t,e){return e(new TypeError("You must pass an array to race."))})},Q.resolve=y,Q.reject=function(t){var e=new this(_);return C(e,t),e},Q._setScheduler=function(t){a=t},Q._setAsap=function(t){s=t},Q._asap=s,Q.polyfill=function(){var t=void 0;if(void 0!==n)t=n;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var r=null;try{r=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===r&&!e.cast)return}t.Promise=Q},Q.Promise=Q,Q})}).call(this,n(3),n(4))},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c,u=[],l=!1,f=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):f=-1,u.length&&h())}function h(){if(!l){var t=s(d);l=!0;for(var e=u.length;e;){for(c=u,u=[];++f<e;)c&&c[f].run();f=-1,e=u.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function v(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||l||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=n(1);function o(t){return"-"!=t&&t?t<=50?"#009966":t<=100?"#ffde33":t<=150?"#ff9933":t<=200?"#cc0033":t<=300?"#660099":"#7e0023":"#aaaaaa"}function a(t){return"-"!=t&&t?t<=50?"#ffffff":t<=100?"#000000":t<=150?"#000000":"#ffffff":"#eeeeee"}e.bgcolor=o,e.fgcolor=a,e.getWidget=function(t,e){var n=moment(t.time.v),s=t.rtsettings.design,c=t.rtsettings.lang;"cn"==c?c="zh-CN":"hk"==c?c="zh-TW":"jp"==c?c="ja":"kr"==c&&(c="ko"),moment.locale(c);var u=r.aqiLang.getShortTitle(t),l=i.s3().c("div",{fontSize:"13px"});l.c("img",{verticalAlign:"text-top"}).a({src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAABXElEQVQokZ2Tu0pDQRCGvzlZYqJRUEKMGgQJ2Ild7G2Sylax1cYX8BEsVQRLfQpLS228NcEiEFRMQI2XxCORg5ozFmsuGA+of7HMzs6//+zMrGS3lm6ApAio8hdUjIgkmztpLT9AO86snTAL6ec/yXVC3gtZbet25u2AhEG9QLJpx7eJEpvFSSyDGQDvisbtOrxddCu7O1ntfIwMTdI3t4E4IetRResP1PdWoeGhXhURaSoLqorExjDjGczIdIsI2MC+OLH5XQDeC/t4h5sIPqZ09EEklSK1soaEozbAdYOLNDqD62dwTw4w5eMPhuNpaufF7shme7616akU5u6kgfEJ8XJZpucsH6j2/b5qvkBDHWRxalslJIxODNLb3xM4I83i1R5fuS+7oFhl9ZXrYg3HkeAJw46v+goSQlBMLnr6q3R/gslF/k92gIr9EDZfOwCCiCC07ZbvywYqnwLPdpYyuPVQAAAAAElFTkSuQmCC"}),l.c("span","waqi-widget-title").t(u),e&&"tiny"!=s||l.c("span",{color:"#aaa",padding:"0 3px 0 0"}).c("small").t(n.format("hA"));var f={minWidth:"20px",textAlign:"center",backgroundColor:o(t.aqi),color:a(t.aqi)};return e&&(f.float="right"),l.c("span","waqi-widget-aqi",f).c("span").t(t.aqi.toString()),e&&("tiny"!=s&&(l.c("div",{color:"#aaa",marginTop:"3px"}).c("small").t(n.format("LLL")),"small"!=s&&(l.c("div",{borderTop:"1px solid #ccc",paddingTop:"5px"}),"forecast"!=s&&l.i(function(t,e){void 0===e&&(e=24);var n="iaqi"==t.rtsettings.design,r=n?30:20,a=i.s3().c("svg:svg",{margin:0,padding:0,borderBottom:"1px solid #eee",height:18*(n?3:1)+12+"px",width:120+r+"px"});try{for(var s=24-moment(t.time.v).hour(),c=0,u={},l=["PM2.5","PM10","O3","time"],f=0;f<l.length;f++){for(var d=null,h=null,p=l[f].replace(".","").toLowerCase(),v=0;v<e;v++){var m=e-v-1;if(t.historic[p]&&t.historic[p][m]){var g=t.historic[p][m].v;(null==d||d>g)&&(d=g),(null==h||h<g)&&(h=g),t[m]?t[m].v=Math.max(t[m].v,g):t[m]={v:g}}}u[p]={min:d,max:h},u.aqi||(u.aqi={min:d,max:h}),u.aqi.min>d&&(u.aqi.min=d),u.aqi.max<h&&(u.aqi.max=h)}for(t.historic.aqi=t,n||(l=["AQI","time"]),f=0;f<l.length;f++){p=l[f].replace(".","").toLowerCase();var y=l[f];for("time"!=y&&a.c("svg:text",{fontFamily:"sans-serif",fontSize:9}).a({x:0,y:c+18-2}).t(y),v=0;v<e;v++){var w=v-s+e;w<24&&(w+=24),w>24&&(w-=24),24==w&&(w=0),m=e-v-1;var _=120/e,b=r+_*v;if("time"==p)(6==w||12==w||0==w||18==w)&&(a.c("svg:rect",{fill:"#888"}).a({x:b,y:0,width:.5,height:18*(l.length-1)+2}),a.c("svg:text",{fontFamily:"sans-serif",fontSize:8,textAnchor:"middle",fill:"#bbb"}).a({x:b,y:c+18-8}).t(w.toString()));else if(t.historic[p]&&t.historic[p][m]){var A=t.historic[p][m].v,q=u[p],x=(d=q.min,15*(A-(d=0))/((h=q.max)-d)),T=o(A);a.c("svg:rect",{fill:T}).a({x:b,y:c+18-x,width:_-.5,height:x})}}c+=18}}catch(t){console.log("Error "+t)}return a}(t)),l.c("center").i(function(t){var e=[],n={},r=new Date;r.setHours(0),t.forecast.aqi.forEach(function(t){var i=t.t.split(/[^0-9]/),o=new Date(i[0],i[1]-1||0,i[2]||1,i[3]||0,i[4]||0,i[5]||0,i[6]||0);if(!(o.getTime()<r.getTime())){var a="D"+moment(o).format("YMD");if(e.indexOf(a)<0&&(e.push(a),n[a]={date:o}),o.getHours()>=7&&o.getHours()<=21){var s=t;if(!(s=s.v.pm25?s.v.pm25:s.v).o3){var c=s[0],u=s[1];n[a].aqi=n[a].aqi||{min:c,max:u,count:0,avg:0},n[a].aqi.min=Math.min(n[a].aqi.min,c),n[a].aqi.max=Math.max(n[a].aqi.max,u),n[a].aqi.avg+=(c+u)/2,n[a].aqi.count+=1}}}});var s=i.s3().c("div");return e.sort(),e.slice(0,4).forEach(function(t,e){if(n[t].aqi&&0!=n[t].aqi.count){n[t].aqi&&n[t].aqi.min,n[t].aqi&&n[t].aqi.max;var r=n[t].aqi?n[t].aqi.avg/n[t].aqi.count:"-",i=moment(n[t].date).format("ddd");s.c("div",{display:"inline-block"}).c("div","waqi-forecast-day-aqi",{fontSize:"10px",backgroundColor:o(r),color:a(r)+"cc"}).t(i)}}),s}(t)))),l=i.s3().c("div","waqi-widget-outer").i(l)),l}},,,,,,function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=n(5);!function(){var t=new r.AqiSettings;t.checkOption("bing").then(function(e){e&&t.onFeedUpdate(function(t){!function t(e,n){if(void 0===n&&(n=0),null==document.getElementById("crs_pane")){var r=200;++n>5&&(r=300),n>10&&(r=200),n>15&&(r=300),n>20&&(r=500),n<30&&setTimeout(function(){return t(e,n)},r)}else e()}(function(){return function(t){if(null!=t){var e=document.getElementById("crs_pane");if(null!=e){var n='<div class="hp_text">'+r.aqiLang.getTitle(t)+"</div>",o=moment(t.time.v).format("ddd, hA"),a=n;a+='<span class="aqi_tile" style="background-color:'+i.bgcolor(t.aqi)+";color:"+i.fgcolor(t.aqi)+'">',a+='<span class="aqi_val segoe_reg" >'+t.aqi+"</span><br>",a+='<span class="aqi_time">'+o,a+="</span>",a+="</span>";var s="waqi-bing-title",c=document.getElementById(s);c||((c=document.createElement("li")).className="no_margin_left pntile",c.id=s,e.insertBefore(c,e.firstChild)),c.innerHTML=a,c.onclick=function(){location.assign(t.city.url)}}}}(t)})})})}()}]);